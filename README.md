## MySQL

### 语句构建顺序
- SELECT [DISTINCT]
- FROM
- JOIN
- WHERE
- GROUP BY
- HAVING
- ORDER BY
- LIMIT

### 语法
- `DISTINCT`：
  - 只能在 `SELECT` 中使用；
  - 必须放在所有字段最前面；
  - 如果后跟多个字段，则是对所有字段的组合进行去重
- `JOIN`：`ON` 条件是在生成临时表时使用的条件，而 `WHERE` 是在临时表生成后进行过滤
  - `INNER JOIN`：只返回**两个表中联结字段相等**的行
  - `LEFT JOIN`：返回**左表中所有记录和右表中联结字段相等**的记录
  - `RIGHT JOIN`：返回**右表中所有记录和左表中联结字段相等**的记录
- `WHERE`：
  - 字符串比较时默认不区分大小写 `'fuses' = 'Fuses'`
  - `BETWEEN start AND end`：限定的是闭区间 `[start, end]`，也可以用于日期
  - `NULL` 只能用 `IS` 匹配，`= < >` 等操作符不会返回 `NULL` 值
  - `NOT`：MySQL 支持使用 `NOT` 对 `IN、BETWEEN、EXISTS` 子句取反
  - `LIKE` 谓词：
    - `%` 通配符，表示任何字符出现任意次数（包含 0 次），但不能匹配 `NULL`
    - `_` 通配符，匹配单个任意字符
    - 把通配符用在搜索的最开始处，是最慢的
  - `REGEXP` 正则表达式支持：MySQL 仅支持多数正则表达式实现的一个很小的子集
    - `REGEXP BINARY` 区分大小写
    - `.` 通配符，匹配单个任意字符
    - `|`：或（`OR`）操作符
    - `[]`：定义一组字符，匹配其中任意一个，`[123]` 等价于 `[1|2|3]`
    - `^`（集合中使用）：否定，不匹配，`[^123]` 意为不匹配 `1、2、3`
    - `[0-9a-zA-Z]`：范围匹配
    - `\\`：转义，用于匹配特殊字符，如果要匹配 `\`，需要使用 `\\\`（MySQL 要求两斜杠是由于 MySQL 自己解释一个、正则表达式库解释另一个）
    - `[[:alnum:]] [[:alpha:]]` 等是预定义的字符类
    - 重复元字符：
      - `*`：0 或多个匹配
      - `+`：1 或多个匹配（等于 `{1,}`）
      - `?`：0 或 1 个匹配（等于 `{0,1}`）
      - `{n}`：n 个匹配
      - `{n,}`：不少于 n 个的匹配
      - `{n,m}`：匹配数目的范围（m 不超过 255）
    - 定位符：
      - `^`（集合外使用）：文本的开始，`^[123]` 意为以 `1/2/3` 开头
      - `$`：文本的结尾
      - `[[:<:]]`：词的开始
      - `[[:>:]]`：词的结尾
  - 子查询：
    - 在 `WHERE` 子句中使用子查询，应该保证子查询的 `SELECT` 语句具有与 `WHERE` 子句中相同数目的列
- `GROUP BY`：
  - `GROUP BY` 指示分组数据，然后对每个组而不是整个结果表使用聚集函数
  - `GROUP BY` 子句可以包含任意数目的列，这使得能对分组进行嵌套，为数据分组提供更细致的控制
  - `GROUP BY` 子句中列出的每个列必须是**检索列**或有效的**表达式**（但**不能是聚集函数**）
  - 除聚集计算语句外，`SELECT` 语句的每个列都必须在 `GROUP BY` 子句中给出
  - 如果分组列中具有 `NULL` 值，则将 `NULL` 作为一个分组返回列，如果列中有多行 `NULL`，它们将分为一组
  - 使用 `WITH ROLLUP` 关键字，可以得到每个分组以及对每个分组汇总级别（二次聚集）的值（作为新的一组返回）
  - `GROUP BY` 分组后的数据顺序无法保证，需要按序时要使用 `ORDER BY`
- `HAVING`：
  - `WHERE` 子句的语法都适用于 `HAVING` 子句，区别在于 `WHERE` 用于过滤行，而 `HAVING` 用于过滤分组（**`WHERE` 在数据分组前过滤，`HAVING` 在数据分组后过滤，`WHERE` 排除的值不会包括在分组中**）
  - `HAVING` 中要过滤的字段必须是在 `SELECT` 中出现的
- `ORDER BY`：
  - 默认是升序 `ASC`，用 `DESC` 指定降序
  - **可以指定非选中 (`SELECT`) 的列用于排序**
  - `ORDER BY a, b, c`：按多个列排序，优先级依次降低
  - `ORDER BY a DESC, b`：复合排序
  - 如果要在多个列上降序排列，则需要在每个列后跟 `DESC`
  - 大小写字母的顺序，例如 `A / a`，取决于数据库的设置（MySQL 中的顺序默认视为相同）
- `LIMIT`：
  - `LIMIT 5`：前 5 行（默认从第 0 行开始）
  - `LIMIT 8, 5`：从第 8 行开始，检索 5 行
  - `LIMIT 4 OFFSET 3`：从第 3 行开始，取 4 行，等同于 `LIMIT 3, 4`
  - 行数不够时，返回其能够返回的所有行
- 函数
  - 文本处理函数
    - 拼接 `Concat()`：例如需要将列 `name` 和列 `location` 以 `name(location)` 的格式查询出来，可以通过：
      ```sql
      SELECT Concat(name, ' (', location, ')')
      FROM vendors
      ```
    - 删除多余空格：
      - 删除左侧多余空格：`LTrim()`
      - 删除右侧多余空格：`RTrim()`
      - 删除左右多余空格：`Trim()`
    - 大小写转换函数：`Upper()` 和 `Lower()`
    - 字符串长度：`Length()`
    - 转换为语音表示的字母数字模式：`Soundex()`
    - 找出串的子串：`Locate()`
    - 返回子串的字符：`SubString()`
    - 返回串左/右的字符：`Left()` 和 `Right()`
  - 日期和时间处理函数（MySQL 中日期格式最好为 `yyyy-mm-dd`）
    - 返回当前日期：`CurDate()`
    - 返回当前时间：`CurTime()`
    - 返回当前日期和时间：`Now()`
    - 增加一个日期：`AddDate()`
    - 增加一个时间：`AddTime()`
    - 计算两个日期之差：`DateDiff()`
    - 高度灵活的日期运算函数：`Date_Add()`
    - 返回一个格式化的日期或时间串：`Date_Format()`
    - 返回一个日期的年份部分：`Year()`
    - 返回一个日期的月数部分：`Month()`
    - 返回一个日期的天数部分：`Day()`
    - 返回一个时间的小时部分：`Hour()`
    - 返回一个时间的分钟部分：`Minute()`
    - 返回一个时间的秒部分：`Second()`
    - 返回一个日期时间的日期部分：`Date()`
    - 返回一个日期时间的时间部分：`Time()`
    - 对于一个日期，返回对应的星期：`DayOfWeek()`
  - 数值处理函数
    - 绝对值：`Abs()`
    - 余弦：`Cos()`
    - 正弦：`Sin()`
    - 正切：`Tan()`
    - 平方根：`Sqrt()`
    - 余数：`Mod()`
    - 指数：`Exp()`
    - 圆周率：`Pi()`
    - 随机数：`Rand()`
  - 聚集函数：只能用于 `SELECT` 子句和 `GROUP BY` 中的 `HAVING` 子句；指定 `DISTINCT` 参数可以忽略重复行的计算
    - 返回某列的平均值：`AVG()`，其忽略值为 `NULL` 的行
    - 返回某列的行数：`COUNT()`
      - `COUNT(*)`：对**表**中行的数目进行计数，包含 `NULL`值；不能使用 `COUNT(DISTINCT)`
      - `COUNT(column)`：对特定**列**中**具有值**的行进行计数，忽略 `NULL` 值
    - 返回某列的最小值：`MIN()`，一般用于数值和日期，用于文本数据时，如果数据按相应的列排序，则返回第一行
    - 返回某列的最大值：`MAX()`，一般用于数值和日期，用于文本数据时，如果数据按相应的列排序，则返回最后一行
    - 返回某列值之和：`SUM()`，其忽略值为 `NULL` 的行
- 列的别名 `AS`